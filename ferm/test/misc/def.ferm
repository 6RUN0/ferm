def $myports= (http ftp);
def &mytcp() = proto $myports;
def &myrule() = proto ah DROP;
def &level() = {
    proto ah;
    proto esp;
}

def &proto_port($a, $b) = proto $a dport $b;

chain INPUT {
    &mytcp() ACCEPT;
    &myrule();
}
chain OUTPUT {
    proto tcp dport (https $myports ntp) REJECT;
    ACCEPT &level();
}
chain FORWARD &proto_port(tcp, http) ACCEPT;
chain FORWARD {
    &proto_port(udp, domain) ACCEPT;
    &proto_port(tcp, (8080 3128)) REJECT;
    &proto_port(tcp, $myports) ACCEPT;
}
